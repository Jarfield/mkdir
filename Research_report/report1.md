# 调研报告 胡揚嘉
## 项目背景
> 个人提醒 ***请勿复制***
> 调研背景部分应该包括对调研主题选择的解释、调研目标和意义的阐述、研究现状和前人研究的综述以及调研的创新和不足之处。
### 正文
操作系统是控制和管理整个计算机系统的硬件和软件资源，并合理的组织和调度计算机的工作和资源的分配，以提供给用户和其它软件方便的接口和环境，它是计算机系统中最基本的系统软件。      
自从操作系统的需求被提出以来，其经历了多次满足具体需求的更新，例如多道批处理系统、分时系统、实时系统、虚拟化技术、个人计算机操作系统、网络操作系统、分布式操作系统等阶段的发展。甚至操作系统的概念逐渐被泛化，Web时代到来，一个网络浏览器也完全可以视作操作系统，其中运用到的操作系统的原理也是数不胜数。如今，站在时代的潮头，借着人工智能和大模型技术的兴起，操作系统面临着新一次的更新迭代。        
随着当代计算机系统的不断发展和复杂化，操作系统内核的性能、安全性和可维护性变得至关重要。调度器作为操作系统内核的核心组件，在实时性、多任务处理和资源管理等方面扮演着关键角色。然而，传统基于C语言编写的调度器可能在性能、安全性和代码复杂性方面存在一些挑战。 
<br>        
**Rust**语言横空出世，在2016年之后在操作系统方面造就了新的潮流。    
Rust在改写Linux源代码方面具有多方面的优势。首先，Rust是一种内存安全的系统级编程语言，其借用检查器和所有权系统可以在编译时捕获许多常见的内存错误，如空指针引用、数据竞争等问题，从而降低了引入漏洞和安全问题的风险。这对于修改Linux内核这样复杂的代码基础来说尤为重要，可以减少潜在的漏洞和错误。    
其次，Rust具有良好的并发性能和线程安全性，通过内置的并发原语和类型系统，可以更容易地编写并发代码而不会出现常见的并发错误。在修改Linux内核时，这些特性可以帮助开发人员更好地处理复杂的并发场景，提高系统的性能和稳定性。 
此外，Rust还具有优秀的生态系统和工具链支持，例如Cargo构建系统和丰富的第三方库，可以加快开发周期并提高代码质量。开发人员可以利用这些工具和库来简化代码编写过程，减少重复工作，并遵循最佳实践。     
总的来说，Rust在改写Linux源代码方面的优势包括内存安全、并发性能、线程安全性以及强大的生态系统支持，这些优势使得使用Rust来修改Linux内核代码更加高效、安全和可靠。    
<br>    
当前Linux内核调度器是操作系统中至关重要的组件，负责管理进程和线程的调度、资源分配以及性能优化。然而，传统基于C语言编写的调度器可能面临一些挑战，包括内存安全性、并发性能和代码复杂性等方面的限制。因此，重新实现 Linux 调度器的动机在于利用 Rust 语言的优势解决这些挑战，从而提升操作系统内核的整体质量和性能。 
> - 内存安全性：Rust 是一种内存安全的系统级编程语言，其所有权系统和借用检查器可以在编译时捕获许多常见的内存错误，如空指针引用和数据竞争。通过将调度器的关键部分用 Rust 重写，可以减少潜在的漏洞和安全问题，提高系统的稳定性和可靠性。    
> - 并发性能：Rust具有良好的并发性能和线程安全性，通过内置的并发原语和类型系统，可以更容易地编写并发代码而不会出现常见的并发错误。在调度器中引入 Rust 的并发特性，可以更有效地处理多任务处理和复杂的并发场景，提升系统的性能和响应速度。  
> - 可维护性：Rust 的严格所有权系统和模式匹配等功能使得代码更加清晰、易读和易于维护。重写调度器的部分代码为 Rust，可以降低代码复杂性，减少错误和提高代码的可维护性，有利于未来的扩展和维护工作。  
综上所述，本实验打算将 Rust 的优势应用于重新实现 Linux 调度器上，可以提升操作系统内核的性能、安全性和可维护性，为现代计算机系统带来更加高效、安全和可靠的调度器组件。   
本次调研的目标是评估采用Rust语言重写Linux调度器的潜在优势，并探讨可能遇到的技术挑战和解决方案。通过比较基于C语言和Rust语言编写的调度器在性能、安全性、可维护性等方面的表现，我们旨在为操作系统内核的改进和优化提供有益参考。    
在现有研究方面，Rust改写已经在学术界和工业界被广泛认同。我们可以看到像LearningOS这样的团队开发的纯粹由Rust编写的LearningOS操作系统在许多方面取得了极为优异的成绩。所以选题为用Rust改写Linux调度器板块非常有价值。   
另外，如果在翻写调度模块的同时，我们考虑在能力内对核心的CFS算法进行修改。使用STUN（Scheduler Tuning using Reinforcement Learning）技术，旨在通过自动调整Linux内核调度程序的参数值来改进静态工作负载的性能。STUN采用强化学习方法，通过调整调度程序的参数并将性能作为奖励，从而精细地优化调度策略和参数。此外，STUN能够高效地优化调度程序，通过预先筛选影响工作负载的参数，显著缩短搜索时间。该论文的结构包括对调度程序和参数优化利用机器学习的研究案例的分析、阐明STUN中使用的强化学习背景技术、描述STUN的结构、运行和特点、评估STUN性能结果以及未来研究领域的结论和展望。[1]

## 遇到的困难，可能的解决方案与调整
当然，目前我们小组还面临着许多困难
    
1. 对现有 C 语言代码的迁移与集成：  
    潜在困难：将现有的` C `或者`C++`语言调度器代码迁移到 Rust 可能需要面对不同的编程范式和语言特性，以及对现有系统的兼容性问题。
    解决方法：Linux是借用微内核思想的宏内核设计，所为本次实验才能考虑修改调度器单个模块。可以采用渐进式迁移的方式，先选择调度器的部分功能进行重写，并逐步扩大范围。同时，通过使用 FFI（Foreign Function Interface）等技术，可以在 Rust 中直接调用现有的 C 函数和库，减少迁移过程中的兼容性问题。
2. 并发性能和线程安全性：
    潜在困难：在多任务处理和复杂的并发场景下，需要保证 Rust 语言调度器的并发性能和线程安全性。
    解决方法：利用 Rust 的并发原语和类型系统，设计合理的数据结构和算法，确保在多线程环境下的稳定性和性能。
3. 生态系统支持和工具链：
    潜在困难：Rust 生态系统的某些方面可能缺乏与操作系统开发相关的特定工具和库。
    解决方法：可以积极参与 Rust 社区，获取相关的工具和库，或者根据需要自行开发和定制适合操作系统开发的工具和库，以满足实际需求。

4. 核 CFS 算法的修改与机器学习优化：
    潜在困难：
    1. 对内核 CFS 算法进行修改以及引入机器学习优化可能需要深入理解 Linux 内核调度的复杂性和特性。
    2. 考虑测试集和训练集的来源
    解决方法：在进行算法修改和机器学习优化时，部分团队成员学习机器学习知识，并进行充分的研究和实验验证。此外，可以结合现有的开源项目和社区资源，以便获得更多的支持和经验分享。
总的来说，采用 Rust 语言重新实现 Linux 调度器是一项具有挑战性但也具有前景的工作。通过克服上述潜在困难并采取相应的解决方法，可以有效地提升操作系统内核的性能、安全性和可维护性，为现代计算机系统带来更高效、安全和可靠的调度器组件。

## 参考文献
[1] Lee, H., Jung, S., & Jo, H. (2022). STUN: Reinforcement-Learning-Based Optimization of Kernel Scheduler Parameters for Static Workload Performance. Applied Sciences; Basel, 12(14), 7072. DOI: 10.3390/app12147072